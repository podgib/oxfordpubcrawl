{% extends 'templates/layout.html' %}

{% block content %}
<h1>{{pub.name}}</h1>
<p>Visited by {{visits}} people</p>

{% if user %}
<form>
  <input id="visited" type="checkbox" name="visited" {% if visited %} checked {% endif %}>
</form>
{% endif %}

{% endblock %}

{% block script %}
<script type="text/javascript">
  function setVisited() {
    data = {'pub_id':{{pub.key().id()}}};
    if ($('#visited').is(':checked')) {
      data['visited'] = $('#visited').val();
    }
    $.post('/ajax/visitpub', data);
  }
  $(function() {
    $('#visited').change(function() {setVisited();});
  });
</script>
{% endblock %}